<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <base href="https://mingrammer.com/go-codelab">
    <title>Go codelab step-by-step page</title>
    <link rel="canonical" href="https://mingrammer.com/go-codelab/server-structure-and-net-http">
    <link rel="stylesheet" href="//fonts.googleapis.com/earlyaccess/notosanskr.css">
    <link rel="stylesheet" href="https://mingrammer.com/go-codelab/css/codelab.css"/>
    <link rel="stylesheet" href="https://mingrammer.com/go-codelab/css/syntax.css"/>
</head>
<body>

<section id="main">
    <div class="sidebar">
    <ul>
        
        
            
                <li class="step-item step-item-passed">
    <a href="https://mingrammer.com/go-codelab/codelab-introduction">
        <p class="item-weight"> 1 </p>
        <p class="item-title"> 코드랩 소개 </p>
    </a>
</li>

            
        
            
                <li class="step-item step-item-passed">
    <a href="https://mingrammer.com/go-codelab/install-and-env">
        <p class="item-weight"> 2 </p>
        <p class="item-title"> 설치 및 환경셋팅 </p>
    </a>
</li>

            
        
            
                <li class="step-item step-item-passed">
    <a href="https://mingrammer.com/go-codelab/project-structure">
        <p class="item-weight"> 3 </p>
        <p class="item-title"> 프로젝트 구조 </p>
    </a>
</li>

            
        
            
                <li class="step-item step-item-passed">
    <a href="https://mingrammer.com/go-codelab/package-and-import">
        <p class="item-weight"> 4 </p>
        <p class="item-title"> 패키지와 임포트 </p>
    </a>
</li>

            
        
            
                <li class="step-item step-item-passed">
    <a href="https://mingrammer.com/go-codelab/struct-and-interface">
        <p class="item-weight"> 5 </p>
        <p class="item-title"> 구조체와 인터페이스 </p>
    </a>
</li>

            
        
            
                <li class="step-item step-item-passed">
    <a href="https://mingrammer.com/go-codelab/client-structure">
        <p class="item-weight"> 6 </p>
        <p class="item-title"> 클라이언트 구조 </p>
    </a>
</li>

            
        
            
                <li class="step-item step-item-passed">
    <a href="https://mingrammer.com/go-codelab/goroutine-and-channel">
        <p class="item-weight"> 7 </p>
        <p class="item-title"> 고루틴과 채널 </p>
    </a>
</li>

            
        
            
                <li class="step-item step-item-active">
    <a href="https://mingrammer.com/go-codelab/server-structure-and-net-http">
        <p class="item-weight"> 8 </p>
        <p class="item-title"> 서버 구조 및 net/http </p>
    </a>
</li>

            
        
            
                <li class="step-item">
    <a href="https://mingrammer.com/go-codelab/how-server-and-logger-works">
        <p class="item-weight"> 9 </p>
        <p class="item-title"> 서버에서의 채널 동작 방식 및 로그 핸들러 </p>
    </a>
</li>

            
        
            
                <li class="step-item">
    <a href="https://mingrammer.com/go-codelab/error-handling-in-go">
        <p class="item-weight"> 10 </p>
        <p class="item-title"> 에러 핸들링 </p>
    </a>
</li>

            
        
            
                <li class="step-item">
    <a href="https://mingrammer.com/go-codelab/how-application-works">
        <p class="item-weight"> 11 </p>
        <p class="item-title"> 애플리케이션 동작 과정 </p>
    </a>
</li>

            
        
    </ul>
</div>

    <div class="preview">
    <div class="preview-title">
        <div class="title-left">Go Codelab (Unofficial, Inspired by Google)</div>
        <div class="title-right">
            <a href="https://github.com/mingrammer/go-codelab" target="_blank">View on Github</a>
            <span>by</span>
            <a href="https://github.com/mingrammer" target="_blank">@mingrammer</a>
            <span> & </span>
            <a href="https://github.com/lawrence-kaybob" target="_blank">@lawrence-kaybob</a>
        </div>
    </div>
    <div class=preview-content>
        <div class="content-title">
            8. 서버 구조 및 net/http
        </div>
        <br>
        <article id="content">
           

<h3 id="server-의-기본-동작-방식"><code>Server</code>의 기본 동작 방식</h3>

<p><code>Server</code>는 기본적으로 3개의 포트 번호에 대한 HTTP 서버를 생성합니다. 각 포트 번호를 달리한 것은 서로 다른 측정값 종류를 받기 위함이여, 각 번호는 다음의 의미를 갖습니다.</p>

<h4 id="8001번은-자이로스코프-센서의-데이터를">8001번은 자이로스코프 센서의 데이터를,</h4>

<h4 id="8002번은-가속도-센서의-데이터를">8002번은 가속도 센서의 데이터를,</h4>

<h4 id="8003번은-온도-및-습도계의-데이터를-받습니다">8003번은 온도 및 습도계의 데이터를 받습니다.</h4>

<p><code>Sensor</code>의 코드에서 봤듯이, HTTP 프로토콜을 이용하기 위해선 <a href="https://golang.org/pkg/net/http/"><code>net/http</code></a> 패키지가 필요합니다. <code>Sensor</code> 클라이언트에서는 단순히 POST 요청을 보내면 되기에 패키지를 <code>import</code>하고 필요한 API를 사용하는 것으로 끝났습니다.</p>

<p>그러나 <code>net/http</code> 패키지에서 서버를 생성하는 메서드인 <a href="https://golang.org/pkg/net/http/#ListenAndServe"><code>ListenAndServe()</code></a> 메서드를 확인해보면, 인자로 <a href="https://golang.org/pkg/net/http/#Handler"><code>Handler Interface</code></a>를 요구하고 있습니다. 이 <code>Handler Interface</code>를 다시 확인해보면, 결국 <a href="https://golang.org/pkg/net/http/#HandlerFunc"><code>ServeHTTP()</code></a>라는 메서드를 요구합니다.</p>

<p><br></p>

<h3 id="handler-interface-구현하기"><code>Handler Interface</code> 구현하기</h3>

<p>따라서, 우리는 <code>ServeHTTP()</code> 메서드가 구현된 <code>Handler Interface</code>가 필요합니다. 이를 위해, 우리는 각 데이터 종류에 대한 <code>Interface</code>를 다음과 같이 만들어줘야 합니다.</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span></span><span class="kd">type</span> <span class="nx">GyroHandler</span> <span class="kd">struct</span> <span class="p">{</span>

<span class="p">}</span>

<span class="kd">type</span> <span class="nx">AccelHandler</span> <span class="kd">struct</span> <span class="p">{</span>

<span class="p">}</span>

<span class="kd">type</span> <span class="nx">TempHandler</span> <span class="kd">struct</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre></div>

<p>위와 같이 핸들러를 만들어주고, 이 핸들러들이 쓸 <code>ServeHTTP()</code> 메서드를 구현해야합니다. 앞에서 우리가 구조체와 인터페이스에 대해 배웠을 때, 다음과 같은 코드를 봤습니다.</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">st</span> <span class="nx">StructType</span><span class="p">)</span> <span class="nx">functionName</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">(</span><span class="nx">returnTypes</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// procssing with &#39;st&#39;</span>
<span class="p">}</span>
</code></pre></div>

<p>특정 메서드를 특정 구조체에 연결하기 위해 <code>Pointer Receiver</code>를 사용했습니다. 우리의 경우, <code>main()</code> 메서드에서 만들었던 <code>Handler Instance</code>를 생성했기 때문에 이 핸들러 인스턴스에서 사용할 수 있는 <code>ServeHTTP()</code> 메서드를 구현해줘야합니다.</p>
<div class="highlight"><pre><code class="language-go" data-lang="go"><span></span><span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">TempHandler</span><span class="p">)</span> <span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// 온도계 및 습도계에서 받은 데이터를 처리합니다.</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">GyroHandler</span><span class="p">)</span> <span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// 자이로 센서에서 받은 데이터를 처리합니다.</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">m</span> <span class="o">*</span><span class="nx">AccelHandler</span><span class="p">)</span> <span class="nx">ServeHTTP</span><span class="p">(</span><span class="nx">w</span> <span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span> <span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">{</span>
	<span class="c1">// 가속도 센서에서 받은 데이터를 처리합니다.</span>
<span class="p">}</span>
</code></pre></div>

<p>이제 다음 페이지에선</p>

<p><br></p>

<h3 id="도전">도전</h3>

<p><code>구조체와 인터페이스</code> 단계에서 만들었던 여러분들만의 센서에 대해 <code>Handler Interface</code>와 <code>ServeHTTP()</code> 메서드를 정의해보세요.</p>

        </article>
    </div>
</div>

</section>
